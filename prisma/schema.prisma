generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model flashcastr_flashes {
  id               Int              @id @default(autoincrement())
  flash_id         BigInt           @unique
  user_fid         Int
  user_username    String?
  user_pfp_url     String?
  cast_hash        String?
  deleted          Boolean?         @default(false)
  flashes          flashes          @relation(fields: [flash_id], references: [flash_id], onUpdate: NoAction)
  flashcastr_users flashcastr_users @relation(fields: [user_fid], references: [fid], onUpdate: NoAction)

  @@index([cast_hash], map: "idx_flashcastr_cast_hash")
  @@index([flash_id], map: "idx_flashcastr_flash_id")
  @@index([user_fid], map: "idx_flashcastr_user_fid")
}

model flashcastr_users {
  fid                Int                  @id
  username           String?
  signer_uuid        String?
  auto_cast          Boolean?
  deleted            Boolean?             @default(false)
  flashcastr_flashes flashcastr_flashes[]

  @@index([signer_uuid], map: "idx_flashcastr_users_signer_uuid")
  @@index([username], map: "idx_flashcastr_users_username")
}

model flashes {
  flash_id              BigInt                  @id @unique(map: "idx_flashes_flash_id")
  city                  String?
  player                String?
  img                   String?
  ipfs_cid              String?
  text                  String?
  timestamp             DateTime?               @db.Timestamp(6)
  flash_count           String?
  flashcastr_flashes    flashcastr_flashes?
  flash_identifications flash_identifications[]

  @@index([city], map: "idx_flashes_city")
  @@index([city, player, timestamp(sort: Desc)], map: "idx_flashes_city_player_timestamp_desc")
  @@index([city, timestamp(sort: Desc)], map: "idx_flashes_city_timestamp_desc")
  @@index([player], map: "idx_flashes_player")
  @@index([player, timestamp(sort: Desc)], map: "idx_flashes_player_timestamp_desc")
  @@index([timestamp], map: "idx_flashes_timestamp")
}

model flash_identifications {
  id                 Int      @id @default(autoincrement())
  source_ipfs_cid    String
  matched_flash_id   BigInt
  matched_flash_name String?
  similarity         Float
  confidence         Float
  created_at         DateTime @default(now())
  flashes            flashes  @relation(fields: [matched_flash_id], references: [flash_id], onUpdate: NoAction)

  @@index([source_ipfs_cid], map: "idx_flash_identifications_source")
  @@index([matched_flash_id], map: "idx_flash_identifications_matched")
}
